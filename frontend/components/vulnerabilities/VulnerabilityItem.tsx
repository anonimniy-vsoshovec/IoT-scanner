import React from "react";
import { Alert, AlertDescription, AlertTitle } from "@/components/ui/alert";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { CheckCircle, XCircle, Info } from "lucide-react";
import { Vulnerability, VulnerabilitySeverity } from "@/types";
import {
	VULNERABILITY_SEVERITY_COLORS,
	VULNERABILITY_SEVERITY_TEXTS,
} from "@/utils/constants";

interface VulnerabilityItemProps {
	vulnerability: Vulnerability;
	onToggle: (vuln: Vulnerability) => Promise<void>;
	isUpdating: boolean;
}

export const VulnerabilityItem: React.FC<VulnerabilityItemProps> = ({
	vulnerability,
	onToggle,
	isUpdating,
}) => {
	const isCriticalOrHigh =
		vulnerability.severity === VulnerabilitySeverity.CRITICAL ||
		vulnerability.severity === VulnerabilitySeverity.HIGH;
	const isFixed = vulnerability.fixed === "true";

	const severityColor =
		VULNERABILITY_SEVERITY_COLORS[
			vulnerability.severity as VulnerabilitySeverity
		];
	const severityText =
		VULNERABILITY_SEVERITY_TEXTS[
			vulnerability.severity as VulnerabilitySeverity
		];

	return (
		<Alert
			variant={isCriticalOrHigh ? "destructive" : "default"}
			className="relative"
		>
			<div className="flex items-start justify-between">
				<div className="flex-1">
					<div className="flex items-center gap-2 mb-2">
						<AlertTitle>{vulnerability.title}</AlertTitle>
						<Badge className={severityColor}>{severityText}</Badge>
						{vulnerability.port && (
							<Badge variant="outline">
								Порт: {vulnerability.port}
							</Badge>
						)}
						{isFixed && (
							<Badge className="bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">
								<CheckCircle className="h-3 w-3 mr-1" />
								Исправлено
							</Badge>
						)}
					</div>
					{vulnerability.description && (
						<AlertDescription className="mb-3">
							{vulnerability.description}
						</AlertDescription>
					)}
					<div className="mt-3 p-3 bg-muted rounded-md">
						<div className="flex items-start gap-2">
							<Info className="h-4 w-4 mt-0.5 text-primary" />
							<div className="flex-1">
								<p className="text-sm font-semibold mb-1">
									Рекомендации по исправлению:
								</p>
								<pre className="text-sm whitespace-pre-wrap font-sans">
									{vulnerability.recommendation}
								</pre>
							</div>
						</div>
					</div>
				</div>
				<Button
					variant={isFixed ? "outline" : "default"}
					size="sm"
					className="ml-4"
					onClick={() => onToggle(vulnerability)}
					disabled={isUpdating}
				>
					{isFixed ? (
						<>
							<XCircle className="h-4 w-4 mr-2" />
							Отметить неисправленной
						</>
					) : (
						<>
							<CheckCircle className="h-4 w-4 mr-2" />
							Отметить исправленной
						</>
					)}
				</Button>
			</div>
		</Alert>
	);
};

