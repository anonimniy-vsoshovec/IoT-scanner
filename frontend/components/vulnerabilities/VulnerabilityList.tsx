import React, { useState } from "react";
import {
	Card,
	CardContent,
	CardDescription,
	CardHeader,
	CardTitle,
} from "@/components/ui/card";
import { CheckCircle } from "lucide-react";
import { Vulnerability } from "@/types";
import { updateVulnerability } from "@/lib/api";
import { VulnerabilityItem } from "./VulnerabilityItem";

interface VulnerabilityListProps {
	vulnerabilities: Vulnerability[];
	onUpdate?: () => void;
}

export const VulnerabilityList: React.FC<VulnerabilityListProps> = ({
	vulnerabilities,
	onUpdate,
}) => {
	const [updating, setUpdating] = useState<number | null>(null);

	const handleToggle = async (vuln: Vulnerability) => {
		setUpdating(vuln.id);
		try {
			await updateVulnerability(vuln.id, vuln.fixed !== "true");
			if (onUpdate) {
				onUpdate();
			}
		} catch (err) {
			console.error("Error updating vulnerability:", err);
		} finally {
			setUpdating(null);
		}
	};

	return (
		<Card>
			<CardHeader>
				<CardTitle>Обнаруженные уязвимости</CardTitle>
				<CardDescription>
					Список уязвимостей безопасности и рекомендации по их
					устранению
				</CardDescription>
			</CardHeader>
			<CardContent>
				{vulnerabilities.length > 0 ? (
					<div className="space-y-4">
						{vulnerabilities.map((vuln) => (
							<VulnerabilityItem
								key={vuln.id}
								vulnerability={vuln}
								onToggle={handleToggle}
								isUpdating={updating === vuln.id}
							/>
						))}
					</div>
				) : (
					<div className="text-center py-8">
						<CheckCircle className="h-12 w-12 mx-auto mb-4 text-green-500" />
						<h3 className="text-lg font-semibold mb-2">
							Уязвимости не обнаружены
						</h3>
						<p className="text-muted-foreground">
							Это устройство не имеет обнаруженных уязвимостей
							безопасности
						</p>
					</div>
				)}
			</CardContent>
		</Card>
	);
};

